# Proxmox VE 7.1 NAS and Gaming VMs - 06 - VM Windows 10

This is the process for getting a basic Windows 10 VM installed on Proxmox with GPU passthrough. 

**NOTES:**

* This is a BASIC setup, just to get one running. 
* Any tuning to the VM for performance will be in a later page.
* VMs using PCIE Passthrough can't be migrated to another machine (*maybe* if the other machine is identical, can't test) using Proxmox Cluster services. 

...

## Table of Contents:
> **Hint:** Github has a drop-down automatic TOC, find the **â‰¡** icon on the top-left

* ^ [README](README.md)  (*links to* ***other pages***)
* 06 - VM Windows 10 (***this page***)
    + [06.A.](#06a-)
* \> [07 - ](07..md) (*next page*)

---

## 06.A. Resources

Credits to these various links. I didn't use one single guide, so my directions include a mix from these. You shouldn't need to read all of these in detail but they may be useful if you need to figure something out.

* [Proxmox Wiki](https://pve.proxmox.com/wiki/Qemu-guest-agent)
* [Heiko's Blog - Blacklisting Graphics Driver](https://www.heiko-sieger.info/blacklisting-graphics-driver/) ... note: actually gives a better method *not* using the blacklist file
* [Passthrough Primary GPU with Proxmox 7.1](https://www.weisb.net/passthrough-primary-gpu-with-proxmox-7-1/)
* [Mathew DePorter - Proxmox PCI Passthrough](https://matthewdeporter.com/proxmox/proxmox-pci-passthrough/)
* [qubidt/proxmox_passthrough_guide.md](https://gist.github.com/qubidt/64f617e959725e934992b080e677656f)

## 06.B. Upload ISOs to Proxmox

Proxmox recently added a feature to directly upload .iso files, including from a remote host without intermediate downloads. 

* Log in to the Proxmox web UI
* Go to 'Datacenter' > [your hostname] > 'local (your hostname)' (this is the storage device under the host) > 'ISO Images' (in the middle column)

### 06.A.i. Windows 10 ISO

To upload the main ISO, Open [this Microsoft page](https://www.microsoft.com/en-us/software-download/windows10ISO) (in another tab/window).

* *Option 1:* If using Linux PC, Mac or mobile device you can get a link directly to an ISO image that contains multiple Windows 10 editions (21H2 is around 5.8GB), *skipping the need to download to your PC first and then upload to Proxmox.* This may also work on a Windows PC but, if not, see next option. 
    + Click through the options until you get a "Download" link
    + Copy the URL for that link
    + In Proxmox 'ISO Images' click 'Download from URL'
    + 'URL:' > Paste in the iso link
    + Click 'Query URL' to fill out 'File name:' (you can modify the filename)
    + Click 'Download' in the Proxmox UI
    + When you see 'TASK OK' in the pop-up, click the 'X' on the pop-up to close it (not the main browser tab)
* *Option 2:* If browsing from a Windows machine you *may* (I'm not able to test whether this page redirects you) have to use the "Media Creation Tool", download the .iso to your machine, and then upload it to Proxmox via these steps. One possible advantage to this is you can get an image for a specific edition of Windows 10, which lowers the file size by <>1GB (almost 5GB instead of almost 6GB). 
    + Download the Media Creation Tool
    + Run through it until you can select the option to download a .iso, wait for the download to complete.
    + 'File:' > select the file from your PC
    + *optional*: Edit the filename (like 'Win10-64bit-21H2-Pro.iso')
    + Click 'Upload' in the Proxmox UI
    + When you see 'TASK OK' in the pop-up, click the 'X' on the pop-up to close it (not the main browser tab)

### 06.A.ii. VirtIO Drivers

* Go to the [official site](https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/) (in another tab/window). 
    + Decide if you want the Stable or Latest drivers (I pick Stable unless I know otherwise). 
    + Click whichever you chose (they *can* be on the same version). 
    + Copy the link address for 'virtio-win-[version number].iso' to your clipboard
        - at time of writing, this was 'virtio-win-0.1.217.iso', but look for newer stable
        - you can copy the link for 'virtio-win.iso' without a version number in it
        - they're the same file, but having the version number may be better so you can have different versions available or easily know when there is a newer version available
    + In Proxmox 'ISO Images' click 'Download from URL'
    + 'URL:' > Paste in the iso link
    + Click 'Query URL' to fill out 'File name:' (you can modify the filename, for instance to add the version if you copied the link without version in the name)
    + Click 'Download' in the Proxmox UI
    + When you see 'TASK OK' in the pop-up, click the 'X' on the pop-up to close it (not the main browser tab)

## Create the VM

**IMPORTANT:** I'm not saying these settings are optimal. Only that they worked. I'll walk through all options. [The Proxmox Wiki](https://pve.proxmox.com/wiki/Windows_10_guest_best_practices) has more information about what is done below. 

* In the Proxmox UI, click "Create VM"
* 'General'
    + 'Node:' = your Proxmox hostname. If you have multiple nodes, you should already know which to pick. Default otherwise.
    + 'VM Id:' = default ("100" if this the first VM)
    + 'Name:' = "Win10" (can be whatever you want)
        - No spaces/etc, this needs to be valid as a DNS host name
        - I've had cases on other systems where long descriptive names caused namespace problems
        - Keep it concise while descriptive enough for you later
    + 'Resource Pool:' = empty (we haven't set any) [[wiki](https://pve.proxmox.com/wiki/User_Management#pveum_resource_pools)]
    + 'Advanced' (checkbox at bottom) = unused (you can use this to set the VM to start at boot, do this later if you want it)
* 'OS'
    + 'Use CD/DVD disc image file (iso)' = selected
        - 'Storage' = "local" (we haven't set up others)
        - 'ISO Image' = click the Windows 10 ISO image from before
        - 'Use physical CD/DVD Drive' = *not selected*
        - 'Do not use any media' = *not selected*
        - 'Type:' = "Microsoft Windows"
        - 'Version:' = '10/2016/2019' ('10' is Windows 10, '2016' is Windows Server 2016, '2019' is Windows Server 2019 ... 11/2022 is for Windows 11 / Windows Server 2022)
* 'System'
    + 'Graphic card:' = "VirtIO-GPU"
    + 'Machine:' = "q35"
    + 'BIOS:' = 

---
> [^ [TOP OF PAGE](#proxmox-ve-71-nas-and-gaming-vms---06---vm-windows-10)] ... ***End:*** *Proxmox VE 7.1 NAS and Gaming VMs - VM Windows 10*
> 
> \> NEXT: [07](07..md)
>
> \< PREV: [05 - Proxmox GPU Passthrough](05.ProxmoxGPUPassthrough.md)
