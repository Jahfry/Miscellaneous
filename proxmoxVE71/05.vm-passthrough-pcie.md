BIOS settings were handled in [this page], summary:

This guide is using ZFS on the host boot disk (rpool), so the rest of this assumes systemd boot. If you're using grub I'll drop some extra info but you'll want to look at that part of other guides to be sure. Similarly this guide is focused on AMD X570/Ryzen, so I'm not adding all Intel options. 

* Add the VFIO modules
    + NOTE: other Linux distributions may have these already built in to the kernel, but Proxmox still uses these as modules
        - Verify this via `cat /boot/config-5.13.19-6-pve |grep -i vfio` (update the name of 'config' for the kernel installed, it will change on updates)
        - Just something to be aware of as guides in the future will likely start omitting this step as it becomes unnecessary
    + Add these lines to '/etc/modules':
        - vfio
        - vfio_iommu_type1
        - vfio_pci
        - vfio_virqfd

```bash
# add this later
```    
* Add kernel boot parameters
    + systemd
        - Add this to '/etc/kernel/cmdline': " quiet amd_iommu=on iommu=pt"
    + grub 
        - Modify the this line in '/etc/default/grub': 
            * GRUB_CMDLINE_LINUX_DEFAULT=
            * Add this to that line: "quiet amd_iommu=on iommu=pt"
        - `proxmox-boot-tool refresh`

* Apply the above changes:
    + `proxmox-boot-tool refresh`
    + `update-ramfs -u -k all` (or `update-ramfs -u` to only update the current kernel)
        - NOTE: I'm unsure both of these are needed
            * if not, which is better?
            * Need to learn more about 'proxmox-boot-tool'

* Get your GPU device ID(s):
    + Use `iommu_list` (created on [this page](04.ProxmoxExtras.md#04b-useful-utilities)) to see the GPU device IDs. 
        - Big GPU (RTX 3080TI, first PCIE slot): '0b:00.0' (video) and '0b:00.0' (audio)
        - Little GPU (GTX 1060, second PCIE slot): '0c:00.0' (video) and '0c:00.0' (audio)
    + For use with the next section, add '0000:' to those. Ie, '0b:00.0' becomes '0000:0b:00.0'.
    + Make note of YOUR output from `iommu_list` and adapt the next commands to match your IDs.
    + For my system they appear as:

<pre>
{snip}
IOMMU Group 28:
	0b:00.0 VGA compatible controller [0300]: NVIDIA Corporation Device [10de:2208] (rev a1)
	0b:00.1 Audio device [0403]: NVIDIA Corporation GA102 High Definition Audio Controller [10de:1aef] (rev a1)
IOMMU Group 29:
	0c:00.0 VGA compatible controller [0300]: NVIDIA Corporation GP106 [GeForce GTX 1060 6GB] [10de:1c03] (rev a1)
	0c:00.1 Audio device [0403]: NVIDIA Corporation GP106 High Definition Audio Controller [10de:10f1] (rev a1)
{snip}
</pre>


* Install and configure `driverctl`
    + **NOTES:**
        - I use driverctl *instead of blacklisting* as it allows you to reassign devices repeatedly and actually use modules normally blacklisted in other guides ([originally found here](https://www.heiko-sieger.info/blacklisting-graphics-driver/)).
        - If you only have 1 GPU device and override it below, **video output to your console monitor will stop**.
        - I have 2 GPUs but I'm overriding both below, which will also disconnect console output. These are different GPU models ... I don't need to worry about having 2 identical devices. **If you do have 2 identical models** you may need to consult another guide to fix issues (but the following may just work, I can't test)
        - If you have 2 GPUs but only want to use 1 for passthrough, only do the 'set-override' below for the one you want to passthrough. 
        - You can get your console video back with a command also shown below
        - Not making an easy copy-paste block for these commands to remind you to update for YOUR IOMMU Ids before using. 

    + `apt install driverctl`
    + `driverctl list-devices` ... shows which devices are on what modules currently. Nvidia GPUs will look like this (AMD but is similar with different module names):
       - > '0000:0c:00.0 nouveau'
       - > '0000:0c:00.1 snd_hda_intel'
    + `driverctl list-overrides` ... should be empty for now
    + Tell driverctl to override your devices, this is the section you should update for your system if different. This is where your console video will disconnect if you override all of your GPUs. 
       - `driverctl set-override 0000:0b:00.0 vfio-pci`
       - `driverctl set-override 0000:0b:00.1 vfio-pci`
       - `driverctl set-override 0000:0c:00.0 vfio-pci`
       - `driverctl set-override 0000:0c:00.1 vfio-pci`
    + `driverctl list-devices` for the GPU now looks like:
       - > '0000:0c:00.0 vfio-pci [\*]'
       - > '0000:0c:00.1 vfio-pci [\*]'
